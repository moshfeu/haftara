<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body {
      direction: rtl;
      font-size: 1.7em;
      line-height: 2;
    }
    .w {
      position: relative;
      display: inline-block;
      color: red;
    }

    .w:hover {
      background: #cfe1ff;
    }

    .wo {
      position: absolute;
      left: 0;
      top: 0;
      color: black;
      cursor: pointer;
      transition: background .1s ease;
    }

    .audio-wrapper {
      position: fixed;
      bottom: 0;
      left: 0;
      width: 100%;
      background: #fff;
      text-align: center;
      z-index: 1;
      padding: 20px 0;
    }

    audio {
      display: block;
      margin: 0 auto;
    }

    .textContainer {
      padding-bottom: 94px;
    }
  </style>
</head>
<body>
  <!-- <button class="save">Save</button> -->
  <div class="audio-wrapper">
    <audio controls autoplay>
      <source src="audio.mp3" type="audio/mpeg" />
    </audio>
  </div>
  <div class="textContainer">
    אָנֹכִ֧י אָנֹכִ֛י ה֖וּא מְנַחֶמְכֶ֑ם מִֽי־אַ֤תְּ וַתִּֽירְאִי֙ מֵאֱנ֣וֹשׁ יָמ֔וּת וּמִבֶּן־אָדָ֖ם חָצִ֥יר יִנָּתֵֽן׃

  וַתִּשְׁכַּ֞ח יְהוָ֣ה עֹשֶׂ֗ךָ נוֹטֶ֣ה שָׁמַיִם֮ וְיֹסֵ֣ד אָרֶץ֒ וַתְּפַחֵ֨ד תָּמִ֜יד כָּל־הַיּ֗וֹם מִפְּנֵי֙ חֲמַ֣ת הַמֵּצִ֔יק כַּאֲשֶׁ֥ר כּוֹנֵ֖ן לְהַשְׁחִ֑ית וְאַיֵּ֖ה חֲמַ֥ת הַמֵּצִֽיק׃

  מִהַ֥ר צֹעֶ֖ה לְהִפָּתֵ֑חַ וְלֹא־יָמ֣וּת לַשַּׁ֔חַת וְלֹ֥א יֶחְסַ֖ר לַחְמֽוֹ׃

  וְאָֽנֹכִי֙ יְהוָ֣ה אֱלֹהֶ֔יךָ רֹגַ֣ע הַיָּ֔ם וַיֶּהֱמ֖וּ גַּלָּ֑יו יְהוָ֥ה צְבָא֖וֹת שְׁמֽוֹ׃

  וָאָשִׂ֤ים דְּבָרַי֙ בְּפִ֔יךָ וּבְצֵ֥ל יָדִ֖י כִּסִּיתִ֑יךָ לִנְטֹ֤עַ שָׁמַ֙יִם֙ וְלִיסֹ֣ד אָ֔רֶץ וְלֵאמֹ֥ר לְצִיּ֖וֹן עַמִּי־אָֽתָּה׃     הִתְעוֹרְרִ֣י הִֽתְעוֹרְרִ֗י ק֚וּמִי יְר֣וּשָׁלַ‍ִ֔ם אֲשֶׁ֥ר שָׁתִ֛ית מִיַּ֥ד יְהוָ֖ה אֶת־כּ֣וֹס חֲמָת֑וֹ אֶת־קֻבַּ֜עַת כּ֧וֹס הַתַּרְעֵלָ֛ה שָׁתִ֖ית מָצִֽית׃

  אֵין־מְנַהֵ֣ל לָ֔הּ מִכָּל־בָּנִ֖ים יָלָ֑דָה וְאֵ֤ין מַחֲזִיק֙ בְּיָדָ֔הּ מִכָּל־בָּנִ֖ים גִּדֵּֽלָה׃

  שְׁתַּ֤יִם הֵ֙נָּה֙ קֹֽרְאֹתַ֔יִךְ מִ֖י יָנ֣וּד לָ֑ךְ הַשֹּׁ֧ד וְהַשֶּׁ֛בֶר וְהָרָעָ֥ב וְהַחֶ֖רֶב מִ֥י אֲנַחֲמֵֽךְ׃

  בָּנַ֜יִךְ עֻלְּפ֥וּ שָׁכְב֛וּ בְּרֹ֥אשׁ כָּל־חוּצ֖וֹת כְּת֣וֹא מִכְמָ֑ר הַֽמְלֵאִ֥ים חֲמַת־יְהוָ֖ה גַּעֲרַ֥ת אֱלֹהָֽיִךְ׃

  לָכֵ֛ן שִׁמְעִי־נָ֥א זֹ֖את עֲנִיָּ֑ה וּשְׁכֻרַ֖ת וְלֹ֥א מִיָּֽיִן׃     כֹּֽה־אָמַ֞ר אֲדֹנַ֣יִךְ יְהוָ֗ה וֵאלֹהַ֙יִךְ֙ יָרִ֣יב עַמּ֔וֹ הִנֵּ֥ה לָקַ֛חְתִּי מִיָּדֵ֖ךְ אֶת־כּ֣וֹס הַתַּרְעֵלָ֑ה אֶת־קֻבַּ֙עַת֙ כּ֣וֹס חֲמָתִ֔י לֹא־תוֹסִ֥יפִי לִשְׁתּוֹתָ֖הּ עֽוֹד׃

  וְשַׂמְתִּ֙יהָ֙ בְּיַד־מוֹגַ֔יִךְ אֲשֶׁר־אָמְר֥וּ לְנַפְשֵׁ֖ךְ שְׁחִ֣י וְנַעֲבֹ֑רָה וַתָּשִׂ֤ימִי כָאָ֙רֶץ֙ גֵּוֵ֔ךְ וְכַח֖וּץ לַעֹבְרִֽים׃    

  עוּרִ֥י עוּרִ֛י לִבְשִׁ֥י עֻזֵּ֖ךְ צִיּ֑וֹן לִבְשִׁ֣י׀ בִּגְדֵ֣י תִפְאַרְתֵּ֗ךְ יְרוּשָׁלַ‍ִ֙ם֙ עִ֣יר הַקֹּ֔דֶשׁ כִּ֣י לֹ֥א יוֹסִ֛יף יָבֹא־בָ֥ךְ ע֖וֹד עָרֵ֥ל וְטָמֵֽא׃

  הִתְנַעֲרִ֧י מֵעָפָ֛ר ק֥וּמִי שְּׁבִ֖י יְרֽוּשָׁלִָ֑ם התפתחו [הִֽתְפַּתְּחִי֙] מוֹסְרֵ֣י צַוָּארֵ֔ךְ שְׁבִיָּ֖ה בַּת־צִיּֽוֹן׃     כִּֽי־כֹה֙ אָמַ֣ר יְהוָ֔ה חִנָּ֖ם נִמְכַּרְתֶּ֑ם וְלֹ֥א בְכֶ֖סֶף תִּגָּאֵֽלוּ׃

  כִּ֣י כֹ֤ה אָמַר֙ אֲדֹנָ֣י יְהוִ֔ה מִצְרַ֛יִם יָֽרַד־עַמִּ֥י בָרִֽאשֹׁנָ֖ה לָג֣וּר שָׁ֑ם וְאַשּׁ֖וּר בְּאֶ֥פֶס עֲשָׁקֽוֹ׃

  וְעַתָּ֤ה מי־ לי־ [מַה־] [לִּי־] פֹה֙ נְאֻם־יְהוָ֔ה כִּֽי־לֻקַּ֥ח עַמִּ֖י חִנָּ֑ם משלו [מֹשְׁלָ֤יו] יְהֵילִ֙ילוּ֙ נְאֻם־יְהוָ֔ה וְתָמִ֥יד כָּל־הַיּ֖וֹם שְׁמִ֥י מִנֹּאָֽץ׃

  לָכֵ֛ן יֵדַ֥ע עַמִּ֖י שְׁמִ֑י לָכֵן֙ בַּיּ֣וֹם הַה֔וּא כִּֽי־אֲנִי־ה֥וּא הַֽמְדַבֵּ֖ר הִנֵּֽנִי׃

  מַה־נָּאו֨וּ עַל־הֶהָרִ֜ים רַגְלֵ֣י מְבַשֵּׂ֗ר מַשְׁמִ֧יעַ שָׁל֛וֹם מְבַשֵּׂ֥ר ט֖וֹב מַשְׁמִ֣יעַ יְשׁוּעָ֑ה אֹמֵ֥ר לְצִיּ֖וֹן מָלַ֥ךְ אֱלֹהָֽיִךְ׃

  ק֥וֹל צֹפַ֛יִךְ נָ֥שְׂאוּ ק֖וֹל יַחְדָּ֣ו יְרַנֵּ֑נוּ כִּ֣י עַ֤יִן בְּעַ֙יִן֙ יִרְא֔וּ בְּשׁ֥וּב יְהוָ֖ה צִיּֽוֹן׃

  פִּצְח֤וּ רַנְּנוּ֙ יַחְדָּ֔ו חָרְב֖וֹת יְרוּשָׁלִָ֑ם כִּֽי־נִחַ֤ם יְהוָה֙ עַמּ֔וֹ גָּאַ֖ל יְרוּשָׁלָ‍ִֽם׃

  חָשַׂ֤ף יְהוָה֙ אֶת־זְר֣וֹעַ קָדְשׁ֔וֹ לְעֵינֵ֖י כָּל־הַגּוֹיִ֑ם וְרָאוּ֙ כָּל־אַפְסֵי־אָ֔רֶץ אֵ֖ת יְשׁוּעַ֥ת אֱלֹהֵֽינוּ׃     ס֤וּרוּ ס֙וּרוּ֙ צְא֣וּ מִשָּׁ֔ם טָמֵ֖א אַל־תִּגָּ֑עוּ צְא֣וּ מִתּוֹכָ֔הּ הִבָּ֕רוּ נֹשְׂאֵ֖י כְּלֵ֥י יְהוָֽה׃

  כִּ֣י לֹ֤א בְחִפָּזוֹן֙ תֵּצֵ֔אוּ וּבִמְנוּסָ֖ה לֹ֣א תֵלֵכ֑וּן כִּֽי־הֹלֵ֤ךְ לִפְנֵיכֶם֙ יְהוָ֔ה וּמְאַסִּפְכֶ֖ם אֱלֹהֵ֥י יִשְׂרָאֵֽל׃
  </div>
  <script src="times.js"></script>
<script>
  const isRecordMode = false;
  const audio = document.querySelector('audio');
  // const times = [];
  document.querySelector('.save', () => {
    localStorage.setItem('times', JSON.stringify(times));
  });

  const special = [1470, 1475, 91, 93]
  const textContainer = document.querySelector('.textContainer');
  textContainer.innerHTML = textContainer.textContent
    .split(' ')
    .filter(a => !!a.trim())
    .map((a, idx) => `<div class="w"><div data-index="${idx}" class="wo" tabindex="0">${cleanNikkud(a)}</div><div>${a}</div></div>`)
    .join(' ');

  const wo = document.querySelectorAll('.wo');

  wo.forEach(wo => {
    if (isRecordMode) {
      ['click', 'focus'].forEach(event => {
        wo.addEventListener(event, e => {
          if (audio.played) {
            times.push(audio.currentTime);
          }
        });
      });
    } else {
      wo.addEventListener('click', e => {
        const {index} = e.target.dataset;
        wordIndex = Number(index);
        audio.currentTime = times[wordIndex];
      });
    }
  });

  wo[0].focus();

  window.onload = function() {
    var context = new AudioContext();
  }

  let wordIndex = 1;
  setInterval(() => {
    if (audio.currentTime > times[wordIndex]) {
      wordIndex++;
      console.log(wordIndex);
      wo[wordIndex - 1].focus();
    }
  }, 100);

  function cleanNikkud(word) {
      return word
        .split('')
        .reduce((o, l) => {
          const code = l.charCodeAt(0);
          // if ((code >= 1488 && code <= 1514) || special.includes(code)) {
          if (!((code <= 1455 && code >= 1400) || code === 1469)) {
            o.push(String.fromCharCode(code));
          }
          return o;
        }, [])
        .join('')
    }
  </script>
</body>
</html>